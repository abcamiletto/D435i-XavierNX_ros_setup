<?xml version="1.0" encoding="UTF-8"?>

<launch>

  <group ns="rtabmap">
    <!--arg name="rtabmapviz"          value="false" /> 
    <arg name="rviz"                value="true" /-->

    <!-- Odometry -->
    <node pkg="rtabmap_ros" type="rgbd_odometry" name="rgbd_odometry" output="screen" args="--delete_db_on_start --Optimizer/GravitySigma 0.3" >
      <remap from="rgbd_image0"       to="/camera1/rgbd_image"/>
      <remap from="rgbd_image1"       to="/camera2/rgbd_image"/>
	  <remap from="imu"             to="/rtabmap1/imu"/>

	  <param name="rgbd_cameras"             type="int"    value="2"/>
	  <param name="publish_tf"               type="bool"   value="true"/>
      <param name="approx_sync"              type="bool"   value="true"/>
      <param name="wait_imu_to_init"         type="bool"   value="true"/>
      <param name="subscribe_rgbd"           type="bool"   value="true"/>
      <param name="frame_id"                 type="string" value="camera1_link"/>
      <param name="Vis/EstimationType"       type="string" value="0"/> 
      <param name="Vis/CorGuessWinSize"      type="string" value="0"/> 
      <param name="OdomF2M/BundleAdjustment" type="string" value="0"/> 
	  <param name="Odom/ResetCountdown" 	 type="string" value="10"/>
    </node>

    <!-- Visual SLAM (robot side) -->
    <!-- args: "delete_db_on_start" and "udebug" -->
    <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen" args="--delete_db_on_start --Optimizer/GravitySigma 0.3">
      <param name="approx_sync"      type="bool"   value="true"/>
	  <param name="subscribe_depth"  type="bool"   value="false"/>
      <param name="subscribe_rgbd"   type="bool"   value="true"/>
      <param name="rgbd_cameras"     type="int"    value="2"/>
      <param name="frame_id"         type="string" value="camera1_link"/>
      <param name="gen_scan"         type="bool"   value="true"/>
      <param name="map_negative_poses_ignored" type="bool"   value="false"/>        <!-- refresh grid map even if we are not moving-->
      <param name="map_negative_scan_empty_ray_tracing" type="bool" value="false"/> <!-- don't fill empty space between the generated scans-->

      <remap from="rgbd_image0"       to="/camera1/rgbd_image"/>
      <remap from="rgbd_image1"       to="/camera2/rgbd_image"/>

      <param name="Grid/FromDepth"     				type="string" value="false"/>
      <param name="Vis/EstimationType"			    type="string" value="0"/> 
      <param name="Vis/CorGuessWinSize"       		type="string" value="0"/>
    </node>


  </group>

  <!-- Visualization RVIZ -->
  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find rtabmap_ros)/launch/config/rgbd.rviz"/>
  <node pkg="nodelet" type="nodelet" name="points_xyzrgb" args="standalone rtabmap_ros/point_cloud_xyzrgb" output="screen">
    <remap from="rgbd_image0"       to="/camera1/rgbd_image"/>
    <remap from="rgbd_image1"       to="/camera2/rgbd_image"/>
    <remap from="cloud"             to="voxel_cloud" />

    <param name="decimation"  type="double" value="4"/>
    <param name="voxel_size"  type="double" value="0.0"/>
    <param name="approx_sync" type="bool"   value="false"/>
  </node>

</launch>
